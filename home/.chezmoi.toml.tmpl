{{- $codespaces:= env "CODESPACES" | not | not }}
{{- $devcontainer:= env "REMOTE_CONTAINERS" | not | not }}
{{- $container := or $devcontainer $codespaces }}

{{- $chezmoiForce := or (has "--force" .chezmoi.args) (has "--force=true" .chezmoi.args) -}}
{{- $interactive := and stdinIsATTY (not $chezmoiForce) -}}

sourceDir = {{ .chezmoi.sourceDir | quote }}
pager = "git-pager"

[data]
{{- if or $container (not $interactive) }}
    email = "kergoth@gmail.com"
    name = "Christopher Larson"
    github_username = "kergoth"
{{- else }}
    email = {{ promptStringOnce . "email" "Email address" "kergoth@gmail.com" | quote }}
    name = {{ promptStringOnce . "name" "Full name" "Christopher Larson" | quote }}
    github_username = {{ promptStringOnce . "github_username" "GitHub username" "kergoth" | quote }}
{{- end }}

{{- if eq .chezmoi.arch "amd64" }}
    nixarch = "x86_64"
{{- else }}
    nixarch = "invalid"
{{- end }}
    in_codespace = {{ $codespaces }}
    in_devcontainer = {{ $devcontainer }}
    in_container = {{ $container }}

[merge]
    #command = "nvim"
    #args = ["-d", "{{ "{{" }} .Destination {{ "}}" }}", "{{ "{{" }} .Source {{ "}}" }}", "{{ "{{" }} .Target {{ "}}" }}"]
    command = "code"
    args = ["--wait", "--merge", "{{ "{{" }} .Destination {{ "}}" }}", "{{ "{{" }} .Source {{ "}}" }}", "{{ "{{" }} .Target {{ "}}" }}", "{{ "{{" }} .Source {{ "}}" }}"]

[hooks.update.post]
command = "bash"
args = ["-c", "$CHEZMOI_SOURCE_DIR/hook_post_update"]
